<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AETHER - Mars Recycling Hub</title>

  <!-- Link to external stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Holographic neon lines background (generated by JS) -->
  <div id="holo-bg" class="holo-bg" aria-hidden="true"></div>

  <main class="container" role="main">
    <header class="header-panel">
      <h1>AETHER</h1>
      <p>Autonomous EcoTech Hub for Extraterrestrial Recycling on Mars</p>
    </header>

    <!-- Trash selection -->
    <section class="trash-container" aria-label="Trash selection">
      <h2>Select human-generated waste</h2>
      <div class="trash-row">
        <div class="trash" draggable="true" data-type="Metal" title="Metal">🛠️</div>
        <div class="trash" draggable="true" data-type="Battery" title="Battery">🔋</div>
        <div class="trash" draggable="true" data-type="Plastic" title="Plastic">🧴</div>
        <div class="trash" draggable="true" data-type="Paper" title="Paper">📄</div>
        <div class="trash" draggable="true" data-type="Textile" title="Textile">🧵</div>
        <div class="trash" draggable="true" data-type="Food" title="Food">🍎</div>
        <div class="trash" draggable="true" data-type="Glass" title="Glass">🥛</div>
        <div class="trash" draggable="true" data-type="Organic" title="Organic">🌿</div>
      </div>
    </section>

    <!-- Modules grid -->
    <section class="modules" aria-label="Processing modules">
      <div class="module" data-module="Sorter" tabindex="0">
        <div class="holo-panel" aria-hidden="true"></div>
        <h3>Sorter 🔄</h3>
        <p>Separates waste into categories.</p>
      </div>

      <div class="module" data-module="Compactor" tabindex="0">
        <div class="holo-panel" aria-hidden="true"></div>
        <h3>Compactor 🟥</h3>
        <p>Compresses inorganic waste for storage.</p>
      </div>

      <div class="module" data-module="Refiner" tabindex="0">
        <div class="holo-panel" aria-hidden="true"></div>
        <h3>Refiner ✨</h3>
        <p>Purifies waste for reuse.</p>
      </div>

      <div class="module" data-module="Synthesizer" tabindex="0">
        <div class="holo-panel" aria-hidden="true"></div>
        <h3>Synthesizer ⚡</h3>
        <p>Transforms refined materials into usable components.</p>
      </div>
    </section>

    <!-- Message HUD -->
    <div id="message" class="message" role="status" aria-live="polite"></div>

    <!-- Tracker + Chart -->
    <section class="tracker" aria-label="Waste tracker">
      <div class="tracker-left">
        <strong>Waste Processed</strong>
        <ul id="trackerList" class="tracker-list" aria-live="polite"></ul>
      </div>
      <div class="tracker-right">
        <canvas id="wasteChart" aria-label="Processed waste chart"></canvas>
      </div>
    </section>

    <footer class="footer">
      Cosmo_Coderz | NASA Space Apps Hackathon 2025
    </footer>
  </main>

  <!-- Script: drag/drop, chart, holo background -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Processing rules
    const processingRules = {
      Metal: ['Sorter', 'Compactor', 'Refiner', 'Synthesizer'],
      Battery: ['Sorter', 'Refiner', 'Synthesizer'],
      Plastic: ['Sorter', 'Compactor', 'Refiner'],
      Paper: ['Sorter', 'Compactor', 'Refiner'],
      Textile: ['Sorter', 'Refiner', 'Synthesizer'],
      Food: ['Sorter', 'Refiner'],
      Glass: ['Sorter', 'Refiner', 'Synthesizer'],
      Organic: ['Sorter', 'Refiner']
    };

    // Colors for types (used for glow & particles)
    const colorMap = {
      Metal: '#bdc3c7',
      Battery: '#f1c40f',
      Plastic: '#8e44ad',
      Paper: '#dcd0ff',
      Textile: '#b39ddb',
      Food: '#2ecc71',
      Glass: '#7d3c98',
      Organic: '#27ae60'
    };

    // Waste counts
    const wasteCount = {
      Metal: 0, Battery: 0, Plastic: 0, Paper: 0,
      Textile: 0, Food: 0, Glass: 0, Organic: 0
    };

    const trashItems = document.querySelectorAll('.trash');
    const modules = document.querySelectorAll('.module');
    const message = document.getElementById('message');
    const trackerList = document.getElementById('trackerList');

    // initialize tracker list
    trackerList.innerHTML = '';
    Object.keys(wasteCount).forEach(type => {
      const li = document.createElement('li');
      li.dataset.type = type;
      li.textContent = `${type}: 0`;
      trackerList.appendChild(li);
    });

    // Chart initialization (doughnut)
    const ctx = document.getElementById('wasteChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(wasteCount),
        datasets: [{
          data: Object.values(wasteCount),
          backgroundColor: [
            '#8e44ad','#9b59b6','#c39bd3','#7d3c98','#bb8fce','#2ecc71','#7d3c98','#27ae60'
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { color: '#fff' } },
          tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw}` } }
        }
      }
    });

    // Dragstart on trash items
    trashItems.forEach(item => {
      item.addEventListener('dragstart', e => {
        e.dataTransfer.setData('application/x-waste', item.dataset.type);
        e.dataTransfer.setData('text/plain', item.innerText);
        e.dataTransfer.effectAllowed = 'move';
      });
    });

    // Utility: create particle burst
    function createParticles(x, y, color) {
      for (let i = 0; i < 10; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = `${x}px`;
        p.style.top = `${y}px`;
        p.style.background = color;
        const dx = (Math.random() - 0.5) * 140 + 'px';
        const dy = (Math.random() - 0.5) * 140 + 'px';
        p.style.setProperty('--dx', dx);
        p.style.setProperty('--dy', dy);
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 900);
      }
    }

    // Helper to update tracker visually
    function updateTracker() {
      trackerList.querySelectorAll('li').forEach(li => {
        const t = li.dataset.type;
        li.textContent = `${t}: ${wasteCount[t]}`;
      });
    }

    // Module drag/drop handlers
    modules.forEach(mod => {
      mod.addEventListener('dragover', e => {
        e.preventDefault();
        mod.classList.add('glow');
      });
      mod.addEventListener('dragleave', () => {
        mod.classList.remove('glow');
      });
      mod.addEventListener('drop', e => {
        e.preventDefault();
        mod.classList.remove('glow');

        const type = e.dataTransfer.getData('application/x-waste');
        const emoji = e.dataTransfer.getData('text/plain') || '';

        // Safety: ensure type exists
        if (!type || !processingRules[type]) {
          message.textContent = 'Unknown item dropped.';
          return;
        }

        if (processingRules[type].includes(mod.dataset.module)) {
          // success
          wasteCount[type] += 1;
          updateTracker();
          chart.data.datasets[0].data = Object.values(wasteCount);
          chart.update();

          // message & particles
          message.textContent = `${emoji} processed by ${mod.dataset.module}! ✅`;
          message.style.color = colorMap[type] || '#9b59b6';
          createParticles(e.clientX, e.clientY, colorMap[type] || '#9b59b6');

          // pulse module glow with that color
          mod.style.setProperty('--glow-color', colorMap[type] || '#9b59b6');
          mod.classList.add('pulse');
          setTimeout(() => {
            mod.classList.remove('pulse');
            mod.style.removeProperty('--glow-color');
          }, 500);

        } else {
          // error
          message.textContent = `❌ ${emoji} cannot be processed by ${mod.dataset.module}!`;
          message.style.color = '#e74c3c';
          mod.classList.add('shake');
          setTimeout(() => mod.classList.remove('shake'), 350);
        }
      });
    });

    // Holo background generation (3D neon lines)
    const holoBg = document.getElementById('holo-bg');
    holoBg.innerHTML = '';
    const lines = 12;
    for (let i = 0; i < lines; i++) {
      const ln = document.createElement('div');
      ln.className = 'holo-line';
      // set index variables for CSS transform/animation timing:
      ln.style.setProperty('--i', i.toString());
      ln.style.setProperty('--rx', `${(i - lines/2) * 6}deg`);
      ln.style.setProperty('--ry', `${(i - lines/2) * 4}deg`);
      holoBg.appendChild(ln);
    }

    // ensure canvas size update for Chart on load/resize
    function resizeChartArea() {
      const right = document.querySelector('.tracker-right');
      if (right) {
        right.style.minHeight = '260px';
      }
    }
    window.addEventListener('resize', resizeChartArea);
    resizeChartArea();
  });
  </script>
</body>
</html>